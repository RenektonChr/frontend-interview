# 单点登录实现原理
  
## 一、什么是单点登录  
  
+ 单点登录SSO（Single Sign On），是一个多系统共存的环境下，用户在一处登录后，就不用了在其他系统登录，也就是用户的一次登录得到其他所有系统的信任。
  
+ 比如现在有业务系统A、B、C以及SSO系统，第一时间访问A系统时，发现没有登录，这时要引导用户去SSO系统登录，根据用户的登录信息，生成一个唯一的凭据token，返回给用户。后期用户访问B、C系统时，携带上对应的凭证到SSO系统去校验，校验通过之后，就可以单点登录。
  
+ 单点登录有一个独立的认证中心，只有认证中心才能接受用户的用户名和密码等信息进行认证，其他系统不提供登录入口，只接受认证中心的间接授权。间接授权通过令牌实现。当用户提供用户名和密码通过认证中心认证后，认证中心会创建授权令牌，在接下来的跳转过程中，授权令牌作为参数发送给各个子系统，子系统拿到令牌得到授权，然后就会进行局部会话。  
  
## 二、单点登录原理  
  
单点登录有同域和跨域两种情况  
  
1. 同域  
  
   适用场景：所有的系统都使用同一个一级域名，通过不同的二级域名来区分。  

   举例说明：公司有一个一级域名 zlt.com，我们有三个系统分别是门户系统（sso.zlt.com）、应用1（app1.zlt.com）和应用2（app2.zlt.com）需要实现系统之间的单点登录，实现架构如下。  
     
   核心原理：  
   + 门户系统的设置的cookie的domain为一级域名也是  zlt.com，这样就可以共享门户的cookie给所有的使用该域名的 xxx.alt.com 的系统，SSO前端的任务也就到这里了。  
   + 使用Spring Session等技术让所有系统共享session。
   + 这样只要门户系统登录之后，无论跳转应用1或者是应用2，都能通过门户Cookie中的sessionId读取到session中的登录信息实现单点登录。 
  
2. 跨域  
   单点登录的系统之间域名不一样，就不可以共享Cookie了，需要一个独立的认证中心（passport），子系统的登录均需要通过passport，子系统本身并不参与登录。  
     
   基本原理：
   + 用户第一次访问应用的时候，因为没有登录会被引导到认证系统中进行登录。
   + 认证系统拿到登录信息之后进行身份校验，通过之后，返回给用户一个认证凭据——令牌。
   + 用户再次访问别的应用的时候，带上令牌作为认证凭证。  
   + 应用系统会把令牌发回到认证服务器进行验证。通过之后就可以在不登录的情况下访问其他信任业务服务器。


